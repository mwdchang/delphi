

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>delphi.translators.for2py.rectify &mdash; delphi  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script type="text/javascript" src="../../../../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/collapsible-lists/css/tree_view.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> delphi
          

          
            
            <img src="../../../../_static/delphi_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../model.html">The Delphi model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../AnalysisGraph_API.html">AnalysisGraph API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../GrFN_API.html">GroundedFunctionNetwork API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../grfn_spec.html">Grounded Function Network (GrFN) JSON Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../grfn_spec.html#change-log">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cpp_api/library_root.html">C++ API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">delphi</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../for2py.html">delphi.translators.for2py</a> &raquo;</li>
        
      <li>delphi.translators.for2py.rectify</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for delphi.translators.for2py.rectify</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">The purpose of this program is to do all the clean up for translate.py.</span>
<span class="sd">This (rectify.py) program will receive OFP generated XML file as an input.</span>
<span class="sd">Then, it removes any unnecessary elements and refactor randomly structured</span>
<span class="sd">(nested) elements into a correct structure. The output file will be</span>
<span class="sd">approximately 30%~40% lighter in terms of number of lines than the OFP XML.</span>

<span class="sd">Example:</span>
<span class="sd">    This script is executed by the autoTranslate script as one</span>
<span class="sd">    of the steps in converted a Fortran source file to Python</span>
<span class="sd">    file. For standalone execution:::</span>

<span class="sd">        $python rectify.py &lt;ast_file&gt;</span>

<span class="sd">ast_file: The XML representation of the AST of the Fortran file. This is</span>
<span class="sd">produced by the OpenFortranParser.</span>

<span class="sd">Author: Terrence J. Lim</span>
<span class="sd">Last Modified: 6/12/2019</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">from</span> <span class="nn">delphi.translators.for2py</span> <span class="k">import</span> <span class="n">For2PyError</span>

<span class="c1"># Dictionary of negated operations</span>
<span class="n">NEGATED_OP</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;.le.&quot;</span> <span class="p">:</span> <span class="s2">&quot;.gt.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;.ge.&quot;</span> <span class="p">:</span> <span class="s2">&quot;.lt.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;.lt.&quot;</span> <span class="p">:</span> <span class="s2">&quot;.ge.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;.gt.&quot;</span> <span class="p">:</span> <span class="s2">&quot;.le.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;.eq.&quot;</span> <span class="p">:</span> <span class="s2">&quot;.ne.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;.ne.&quot;</span> <span class="p">:</span> <span class="s2">&quot;.eq.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;&lt;=&quot;</span> <span class="p">:</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;&gt;=&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;&quot;</span>
              <span class="p">}</span>

<div class="viewcode-block" id="RectifyOFPXML"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML">[docs]</a><span class="k">class</span> <span class="nc">RectifyOFPXML</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># True if derived type declaration exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if derived type var. refecrence exist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type_ref</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if current var. is an array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_array</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if format exist in the code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_format</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if current var. is for function argument</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_function_arg</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True only if goto-stmt exists in the AST</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">need_goto_elimination</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if more goto-stmt exists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">continue_elimination</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if operation negation is needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">need_op_negation</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if any statement requires reconstruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if each goto case is ready for reconstruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_after_case_now</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_before_case_now</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if each goto case encountered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if statement nests stop statement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_stop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if statements follow either after</span>
        <span class="c1"># goto or label. Both cannot be true</span>
        <span class="c1"># at the same time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_goto</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if collecting of statement is done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collecting_stmts_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if reconstruction (goto elimination) is done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_after_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_before_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># True if one reconstructed statement needs another</span>
        <span class="c1"># reconstruction by nesting it under do while due to</span>
        <span class="c1"># label_before case exist as it&#39;s parent goto</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Keep a track where goto was declared</span>
        <span class="c1"># whether it&#39;s under program(main) or loop body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Keeps records of encountered &lt;goto-stmt&gt; lbl value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Keeps records of encountered &lt;label&gt; lbl value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># A name mapper list for declared</span>
        <span class="c1"># &#39;label_flag_&#39; variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declared_label_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declared_goto_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># A list to hold save_entity tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Keep a track of all encountered goto and label stmts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encountered_goto_label</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Keep a track of goto and label with its case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Keeps a track of current label of goto-stmt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Keep a track of operations for conditional goto</span>
        <span class="c1"># key will be the unique code assigned to each &lt;goto-stmt&gt;</span>
        <span class="c1"># {code:Element}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditional_op</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Counts the number of &lt;goto-stmt&gt; in the code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_stmt_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Keep a track of collected goto-stmts and labels</span>
        <span class="c1"># for goto elimination and reconstruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stmts_after_goto</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;goto-stmts&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="c1"># Dictionary to hold statements before_after case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;stmts-follow-label&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;count-gotos&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Dictionary to hold statements label_after case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;stmts-follow-goto&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;stmts-follow-label&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;count-gotos&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Keeps a track of current derived type name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_derived_type_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Keeps a track of current scope of code</span>
        <span class="c1"># i.e. program, main, or function, etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Keep a track of both array and non-array variables</span>
        <span class="c1"># in the dictionary of {&#39;name&#39; : &#39;scope&#39;}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Keep a track of declared derived type variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Holds variables extracted from derived type refenrece</span>
        <span class="c1"># i.e. x%y%z, then x and y and z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Keeps track of subscripts of arrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscripts_holder</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Holds format XML for later reconstruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_holder</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># Holds a type of parent element&#39;s type element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_type</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># Holds XML of derived type reference for later reconstruction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_ref</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># Actually holds XML of current scope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_body_scope</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                  TAG LISTS FOR EACH HANDLER                   #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

    <span class="n">file_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;program&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subroutine&quot;</span><span class="p">,</span>
        <span class="s2">&quot;module&quot;</span><span class="p">,</span>
        <span class="s2">&quot;declaration&quot;</span><span class="p">,</span>
        <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prefix&quot;</span>
    <span class="p">]</span>

    <span class="n">program_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;header&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span>
    <span class="p">]</span>

    <span class="n">statement_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;assignment&quot;</span><span class="p">,</span>
        <span class="s2">&quot;write&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;execution-part&quot;</span><span class="p">,</span>
        <span class="s2">&quot;print&quot;</span><span class="p">,</span>
        <span class="s2">&quot;open&quot;</span><span class="p">,</span>
        <span class="s2">&quot;read&quot;</span><span class="p">,</span>
        <span class="s2">&quot;close&quot;</span><span class="p">,</span>
        <span class="s2">&quot;call&quot;</span><span class="p">,</span>
        <span class="s2">&quot;statement&quot;</span><span class="p">,</span>
        <span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;continue-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;do-term-action-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;return&quot;</span><span class="p">,</span>
        <span class="s2">&quot;contains-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;declaration&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prefix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="s2">&quot;internal-subprogram&quot;</span><span class="p">,</span>
        <span class="s2">&quot;internal-subprogram-part&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prefix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;exit&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">loop_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;header&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span>
    <span class="p">]</span>

    <span class="n">specification_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;declaration&quot;</span><span class="p">,</span>
        <span class="s2">&quot;use&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">declaration_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dimensions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variables&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type-declaration-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prefix-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;save-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;saved-entity&quot;</span><span class="p">,</span>
        <span class="s2">&quot;access-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;attr-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;access-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;access-id-list&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">value_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">derived_type_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;declaration-type-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type-param-or-comp-def-stmt-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-decl-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-initialization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data-component-def-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-def-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-shape-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;explicit-shape-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-attr-spec-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end-type-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;derived-type-def&quot;</span><span class="p">,</span>

    <span class="p">]</span>

    <span class="n">header_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;index-variable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arguments&quot;</span><span class="p">,</span>
        <span class="s2">&quot;names&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;loop-control&quot;</span><span class="p">,</span>
        <span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;equiv-operand__equiv-op&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subroutine-stmt&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">body_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;specification&quot;</span><span class="p">,</span>
        <span class="s2">&quot;statement&quot;</span><span class="p">,</span>
        <span class="s2">&quot;loop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;if&quot;</span><span class="p">,</span>
        <span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;do-term-action-stmt&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">operand_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">subscripts_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">index_range_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;lower-bound&quot;</span><span class="p">,</span>
        <span class="s2">&quot;upper-bound&quot;</span><span class="p">,</span>
        <span class="s2">&quot;step&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">bound_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">module_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;header&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body&quot;</span><span class="p">,</span>
        <span class="s2">&quot;module-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;members&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end-module-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;contains-stmt&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">members_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;subroutine&quot;</span><span class="p">,</span>
        <span class="s2">&quot;module-subprogram&quot;</span><span class="p">,</span>
        <span class="s2">&quot;module-subprogram-part&quot;</span><span class="p">,</span>
        <span class="s2">&quot;declaration&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prefix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;function&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">only_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;only&quot;</span><span class="p">,</span>
        <span class="s2">&quot;only-list&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">unnecessary_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;do-variable&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end-program-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;main-program&quot;</span><span class="p">,</span>
        <span class="s2">&quot;char-selector&quot;</span><span class="p">,</span>
        <span class="s2">&quot;declaration-type-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type-param-or-comp-def-stmt-list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-decl-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data-component-def-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-def-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;component-initialization&quot;</span><span class="p">,</span>
        <span class="s2">&quot;attr-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;attr-id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;designator&quot;</span><span class="p">,</span>
        <span class="s2">&quot;int-literal-constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;char-literal-constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;real-literal-constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;io-control-spec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;array-spec-element&quot;</span><span class="p">,</span>
        <span class="s2">&quot;print-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;print-format&quot;</span><span class="p">,</span>
        <span class="s2">&quot;keyword-argument&quot;</span><span class="p">,</span>
        <span class="s2">&quot;end-subroutine-stmt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;logical-literal-constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;equiv-op&quot;</span><span class="p">,</span>
        <span class="s2">&quot;equiv-operand&quot;</span><span class="p">,</span>
        <span class="s2">&quot;saved-entity-list__begin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;saved-entity-list&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">output_child_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                       HANDLER FUNCTONS                        #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_file"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_file">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_file</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elementss</span>
<span class="sd">            between the file elementss.</span>

<span class="sd">            In order to control new sub-element creation under</span>
<span class="sd">            the current element, if child.tag == &quot;__tag_name__&quot;</span>
<span class="sd">            has been added. If any new tag(s) that is not being</span>
<span class="sd">            handled currently, appears in the future, add</span>
<span class="sd">            child.tag == &quot;__tag_name__&quot; at the end of the last</span>
<span class="sd">            condition. This applies all other handler functions.</span>

<span class="sd">            &lt;file&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/file&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_file: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_program"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_program">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_program</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML</span>
<span class="sd">            elementss between the program elementss.</span>
<span class="sd">            &lt;program&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/program&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_child_tags</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_body_scope</span> <span class="o">=</span> <span class="n">cur_elem</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_program: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_header"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_header">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_header</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the header elementss.</span>
<span class="sd">            &lt;header&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/header&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This holder will be used only when refactoring</span>
        <span class="c1"># of header is needed, such as with odd syntax</span>
        <span class="c1"># of .eqv. operator</span>
        <span class="n">temp_elem_holder</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">target_tags</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
                <span class="s2">&quot;equiv-operand__equiv-op&quot;</span>
        <span class="p">]</span>
        <span class="n">need_refactoring</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_child_tags</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subroutine-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                                <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">target_tags</span><span class="p">:</span>
                        <span class="n">temp_elem_holder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;equiv-operand__equiv-op&quot;</span><span class="p">:</span>
                            <span class="n">need_refactoring</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_header: Empty elements  &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
        <span class="k">if</span> <span class="n">need_refactoring</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_header</span><span class="p">(</span><span class="n">temp_elem_holder</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
            <span class="n">need_refactoring</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_body"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_body">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_body</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the body elementss.</span>
<span class="sd">            &lt;body&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/body&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_child_tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>

                    <span class="c1"># Handling conditional &lt;goto-stmt&gt;</span>
                    <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span>
                                <span class="ow">and</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="p">):</span>
                            <span class="k">assert</span> <span class="p">(</span>
                                    <span class="s2">&quot;lbl&quot;</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="p">),</span> <span class="s2">&quot;Label &#39;lbl&#39; must be present to store the value in the &lt;if&gt; attrib&quot;</span>

                            <span class="c1"># goto-stmt counter will be used as</span>
                            <span class="c1"># an identifier for two statements</span>
                            <span class="c1"># that are nested one in another</span>
                            <span class="n">unique_code</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goto_stmt_counter</span><span class="p">)</span>

                            <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;conditional-goto-stmt-lbl&#39;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                            <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unique_code</span>
                            <span class="k">if</span> <span class="s2">&quot;goto-move&quot;</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                            <span class="k">if</span> <span class="s2">&quot;goto-remove&quot;</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                            <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;conditional-goto-stmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                            <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unique_code</span>

                        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span>
                                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span>
                                    <span class="ow">or</span> <span class="p">(</span>
                                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;statement&quot;</span>
                                        <span class="ow">and</span> <span class="s2">&quot;conditional-goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                                    <span class="p">)</span>
                            <span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_parent</span> <span class="o">=</span> <span class="n">current</span>
                        <span class="c1"># Reconstruction of statements</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="s2">&quot;parent&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span>
                                <span class="ow">and</span> <span class="p">(</span>
                                <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span>
                                    <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;program&quot;</span><span class="p">)</span>
                                <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span>
                                    <span class="ow">and</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;loop&quot;</span><span class="p">)</span>
                                    <span class="p">)</span>
                        <span class="p">):</span>
                            <span class="c1"># Remove statements that is marked to be removed (2nd traverse)</span>
                            <span class="k">if</span> <span class="p">(</span>
                                    <span class="s2">&quot;goto-remove&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                                    <span class="ow">or</span> <span class="s2">&quot;goto-move&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="p">):</span>
                                <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>

                                <span class="k">if</span> <span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_after_case_now</span>
                                        <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_after_done</span>
                                <span class="p">):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_goto_after_label</span><span class="p">(</span>
                                        <span class="n">new_parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span>
                                    <span class="p">)</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">continue_elimination</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">if</span> <span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_before_case_now</span>
                                        <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_before_done</span>
                                <span class="p">):</span>
                                    <span class="n">reconstruct_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_goto_before_label</span><span class="p">(</span>
                                        <span class="n">new_parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstruct_target</span>
                                    <span class="p">)</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span><span class="p">:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">continue_elimination</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">if</span> <span class="p">(</span>
                                        <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span>
                                        <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span>
                                <span class="p">):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">continue_elimination</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_body: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_child_tags</span>
                        <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;statement&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;statement&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                            <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_body: Empty elements  &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_format</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_format</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_format</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_specification"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_specification">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_specification</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the specification elementss.</span>
<span class="sd">            &lt;specification&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/specification&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">specification_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_specification: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;declaration&quot;</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_specification: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_declaration"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_declaration">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_declaration</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the declaration elementss.</span>
<span class="sd">            &lt;declaration&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/declaration&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declaration_child_tags</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_format</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">format_holder</span> <span class="o">=</span> <span class="n">child</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">is_array</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                            <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-array-spec&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_declaration: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declaration_child_tags</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;saved-entity&quot;</span><span class="p">:</span>
                        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                            If you find saved-entity, add the element to a list </span>
<span class="sd">                            and remove it from the XML since you want to shift </span>
<span class="sd">                            it below save-stmt</span>
<span class="sd">                        &quot;&quot;&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">saved_entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;save-stmt&quot;</span><span class="p">:</span>
                        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                            If you find save-stmt, check if it contains </span>
<span class="sd">                            saved-entities and add it below this XML element</span>
<span class="sd">                        &quot;&quot;&quot;</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saved_entities</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_entities</span><span class="p">:</span>
                                <span class="n">sub_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                                         <span class="n">item</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>

                            <span class="c1"># Reinitialize this list since you&#39;ll need an</span>
                            <span class="c1"># empty one for the next SAVE statement</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">saved_entities</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl-list&quot;</span>
                <span class="p">):</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;derived-type&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-array-spec&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                            <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_child_tags</span>
                    <span class="p">):</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="kc">False</span>
                        <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;self.In handle_tag_declaration: Empty elements &quot;&#39;</span> \
                            <span class="n">f</span><span class="s1">&#39;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_array</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_array</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># If is_derived_type is true,</span>
        <span class="c1"># reconstruct the derived type declaration AST structure</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">:</span>
                <span class="c1"># Modify or add &#39;name&#39; attribute of the MAIN (or the outer</span>
                <span class="c1"># most) &lt;type&gt; elements with the name of derived type name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent_type</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_derived_type_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_derived_type_declaration</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_type"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_type">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_type</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the variables elementss.</span>
<span class="sd">            &lt;type&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/type&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;keyword2&quot;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span>
                <span class="c1"># Having a nested &quot;type&quot; indicates that this is</span>
                <span class="c1"># a &quot;derived type&quot; declaration.</span>
                <span class="c1">#    In other word, this is a case of</span>
                <span class="c1">#    &lt;type&gt;</span>
                <span class="c1">#        &lt;type&gt;</span>
                <span class="c1">#            ...</span>
                <span class="c1">#        &lt;/type&gt;</span>
                <span class="c1">#    &lt;/type&gt;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent_type</span> <span class="o">=</span> <span class="n">current</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;derived-type-stmt&quot;</span><span class="p">:</span>
                <span class="c1"># If child.tag is derived-type-stmt while self.is_derived_type</span>
                <span class="c1"># is not true, it&#39;s an indication of only a sinlge variable</span>
                <span class="c1"># was declared under the derived type declaration, so the syntax</span>
                <span class="c1"># has no nested type case like above. Thus, in order to make</span>
                <span class="c1"># the syntax same, I&#39;m adding another type and nest everything</span>
                <span class="c1"># under it.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">type_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                    <span class="n">type_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">))</span>
                    <span class="n">type_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent_type</span> <span class="o">=</span> <span class="n">current</span>
                <span class="c1"># Modify or add &#39;name&#39; attribute of the &lt;type&gt;</span>
                <span class="c1"># elements with the name of derived type name</span>
                <span class="n">current</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                <span class="c1"># And, store the name of the derived type name for</span>
                <span class="c1"># later setting the outer most &lt;type&gt; elements&#39;s name attribute</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_derived_type_name</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;intrinsic-type-spec&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;derived-type-spec&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;typeName&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-array-spec&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl&quot;</span>
                    <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl-list&quot;</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_type: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
        <span class="c1"># This will mark whether this type declaration is for a derived type</span>
        <span class="c1"># declaration or not</span>
        <span class="n">current</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;is_derived_type&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">))</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_variables"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_variables">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_variables</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the variables elements.</span>
<span class="sd">            &lt;variables&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/variables&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="c1"># Up to this point, all the child (nested or sub) elements were</span>
                <span class="c1"># &lt;variable&gt;</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="n">cur_elem</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;is_array&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_array</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_variables: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_variable"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_variable">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_variable</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the variables elementss.</span>
<span class="sd">            &lt;variable&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/variable&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Store all declared variables based on their array status</span>
        <span class="k">if</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">}</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;initial-value&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_variable: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;entity-decl&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_variable: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_statement"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_statement">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_statement</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the statement elementss.</span>
<span class="sd">            &lt;statement&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/satement&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">label_presented</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">statement_child_tags</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_stop</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;has-stop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>

                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                    <span class="n">label_presented</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">lbl</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">encountered_goto_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Label-before case</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span>
                                <span class="ow">or</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span>
                        <span class="p">):</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;before&quot;</span>
                            <span class="c1"># Since we want to handle label_after case before</span>
                            <span class="c1"># label_before when both cases appear in the code,</span>
                            <span class="c1"># we ignore all label_bafore case until _after case</span>
                            <span class="c1"># get handled. Thus, mark label_before to false</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
                        <span class="c1"># Label-after case</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;after&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_goto</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>

                        <span class="k">if</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> 
                                <span class="ow">or</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span>
                        <span class="p">):</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target-label-statement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>

                        <span class="c1"># Since &lt;format&gt; is followed by &lt;label&gt;,</span>
                        <span class="c1"># check the case and undo all operations done for goto.</span>
                        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format&quot;</span> <span class="ow">and</span> <span class="n">label_presented</span><span class="p">:</span>
                            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">del</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target-label-statement&#39;</span><span class="p">]</span>
                            <span class="k">del</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span>
                            <span class="n">label_presented</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                                <span class="n">traverse</span> <span class="o">&gt;</span> <span class="mi">1</span>
                        <span class="p">),</span> <span class="s2">&quot;In handle_tag_statement. Reconstruction must be done in traverse &gt; 1.&quot;</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collecting_stmts_done</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_after_case_now</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">collecting_stmts_done</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                <span class="c1"># If a &#39;name&#39; tag is the direct sub-elements of &#39;statement&#39;,</span>
                <span class="c1"># it&#39;s an indication of this statement is handling</span>
                <span class="c1"># (usually assignment) derived type variables. Thus,</span>
                <span class="c1"># in order to make concurrent with other assignment syntax,</span>
                <span class="c1"># remove the outside name elements (but store it to the temporary</span>
                <span class="c1"># holder) and reconstruct it before the end of statement</span>
                <span class="k">assert</span> <span class="n">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;goto-stmt&quot;</span><span class="p">:</span>
                <span class="c1"># &lt;goto-stmt&gt; met, increment the counter</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">goto_stmt_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># If goto-stmt was seen, we do not construct element for it.</span>
                <span class="c1"># However, we collect the information (attributes) that is</span>
                <span class="c1"># associated to the existing OFP generated element</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">need_goto_elimination</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">target_lbl</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-stmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_lbl</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="c1"># Reaching goto-stmt is a flag to stop collecting stmts</span>
                <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">encountered_goto_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_lbl</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span><span class="p">:</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;next-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                            <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">collecting_stmts_done</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="c1"># A case where label appears &quot;before&quot; goto</span>
                    <span class="k">if</span> <span class="n">target_lbl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">[</span><span class="n">target_lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;before&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                            <span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_before</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_lbl</span><span class="p">)</span>
                        <span class="c1"># self.label_before = False</span>
                    <span class="c1"># A case where label appears &quot;after&quot; goto</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">[</span><span class="n">target_lbl</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;after&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="k">if</span> <span class="s2">&quot;parent-goto&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;skip-collect&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_lbl</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_goto</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">target_lbl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                                <span class="n">traverse</span> <span class="o">&gt;</span> <span class="mi">1</span>
                        <span class="p">),</span> <span class="s2">&quot;Reconstruction cannot happen in the first traverse&quot;</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_before_case_now</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_statement: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

        <span class="c1"># Statement collector (1st traverse)</span>
        <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span><span class="p">:</span>
                <span class="c1"># Since we do not want to extract the stop statement from</span>
                <span class="c1"># that is not a main body, check it before extraction</span>
                <span class="k">if</span> <span class="s2">&quot;has-stop&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                        <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                            <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span>
                            <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;program&quot;</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                            <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_goto</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="k">if</span> <span class="s2">&quot;has-stop&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                            <span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span>
                                <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;program&quot;</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                                <span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

                    <span class="k">if</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stmts_after_goto</span><span class="p">[</span><span class="s1">&#39;goto-stmts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="s2">&quot;target-label-statement&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stmts_after_goto</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                        <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">parent</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span>
                                <span class="ow">and</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;program&quot;</span>
                                <span class="ow">and</span> <span class="s2">&quot;has-stop&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="p">)</span>
                            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_under_loop</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_after_case_now</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_assignment"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_assignment">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_assignment</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the assignment elementss.</span>
<span class="sd">            &lt;assignment&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/assignment&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;target&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_assignment: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_target"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_target">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_target</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the target elementss.</span>
<span class="sd">            &lt;target&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/target&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_name_element</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_target: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_names"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_names">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_names</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the names elements.</span>
<span class="sd">            &lt;names&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;names&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="c1"># If the element holds subelements,</span>
                <span class="c1"># call the XML tree parser with created</span>
                <span class="c1"># new &lt;name&gt; element</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="c1"># Else, update the element&#39;s attribute</span>
                <span class="c1"># with the default &lt;name&gt; element attributes</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;hasSubscripts&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;is_array&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;numPartRef&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ambiguous&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="c1"># Check if the variable is a function argument</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_function_arg</span><span class="p">:</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;is_arg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;is_arg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
                    <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_names: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_name"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_name">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elementss between the name elements.</span>
<span class="sd">            &lt;name&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;name&gt;</span>

<span class="sd">            There are three different types of names that the type attribute can hold:</span>
<span class="sd">                (1) variable  - Simple (single) variable or an array</span>
<span class="sd">                (2) procedure - Function (or procedure) call</span>
<span class="sd">                (3) ambiguous - None of the above two type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># All variables have default &quot;is_array&quot; value &quot;false&quot;</span>
        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>

        <span class="c1"># If &#39;id&#39; attribute holds &#39;%&#39; symbol, it&#39;s an indication of derived type referencing</span>
        <span class="c1"># Thus, clean up the &#39;id&#39; and reconstruct the &lt;name&gt; AST</span>
        <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="s2">&quot;%&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type_ref</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_derived_type_ref</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscripts&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;assignment&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscripts&quot;</span><span class="p">:</span>
                        <span class="c1"># Default</span>
                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="c1"># Check whether the variable is an array AND the</span>
                        <span class="c1"># variable is for the current scope. This is important</span>
                        <span class="c1"># for derived type variable referencing</span>
                        <span class="k">if</span> <span class="p">(</span>
                                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span>
                                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="p">[</span>
                                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                                    <span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span>
                        <span class="p">):</span>
                            <span class="c1"># Since the procedure &quot;call&quot; has a same AST syntax</span>
                            <span class="c1"># as an array, check its type and set the &quot;is_array&quot; value</span>
                            <span class="k">assert</span> <span class="p">(</span>
                                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;procedure&quot;</span>
                            <span class="p">),</span> <span class="s2">&quot;Trying to assign a procedure call to while is_array true.&quot;</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                        <span class="k">elif</span> <span class="p">(</span>
                                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                                <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span>
                                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span><span class="p">[</span>
                                        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                                    <span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span>
                        <span class="p">):</span>
                            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">)</span>
                    <span class="p">),</span> <span class="s2">&quot;derived_type_var holder must be empty.&quot;</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In self.handle_tag_name: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;generic_spec&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;data-ref&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="kc">False</span>
                        <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In self.handle_tag_name: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

        <span class="c1"># If the name element is for handling</span>
        <span class="c1"># derived type references, reconstruct it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_derived_type_names</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type_ref</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_value"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_value">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the value elementss.</span>
<span class="sd">            &lt;value&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/value&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_value: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_name_element</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_literal"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_literal">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_literal</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the literal elementss.</span>
<span class="sd">            &lt;literal&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/literal&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_id</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="kc">False</span>
                        <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_literal: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_literal: Empty &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_dimensions"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_dimensions</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the dimensions elementss.</span>
<span class="sd">            &lt;dimensions&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/dimensions&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;dimension&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="kc">False</span>
                        <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_dimensions: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_dimensions: Empty &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_dimension"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_dimension">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_dimension</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the dimension elementss.</span>
<span class="sd">            &lt;dimension&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/dimension&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;range&quot;</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="kc">False</span>
                        <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_dimension: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_dimension: Empty &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_loop"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_loop">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_loop</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the do loop elementss.</span>
<span class="sd">            &lt;loop&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/loop&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loop_child_tags</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_format</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">format_holder</span> <span class="o">=</span> <span class="n">child</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                            <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In self.handle_tag_loop: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_index_variable_or_range"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_index_variable_or_range">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_index_variable_or_range</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elementss</span>
<span class="sd">            between the index_variable or range elementss.</span>
<span class="sd">            &lt;index_variable&gt;                    &lt;range&gt;</span>
<span class="sd">                ...                 or              ...</span>
<span class="sd">            &lt;/index_variable&gt;                   &lt;/range&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_range_child_tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_index_variable_or_range: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">traverse</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_index_variable_or_range: Empty &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_bound"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_bound">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_bound</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the upper_bound elementss.</span>
<span class="sd">            &lt;upper_bound&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/upper_bound&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bound_child_tags</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_name_element</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_upper_bound: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">traverse</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_upper_bound: Empty &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_subscripts"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_subscripts">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_subscripts</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the subscripts elementss.</span>
<span class="sd">            &lt;supscripts&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/supscripts&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscript&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In self.handle_tag_subscripts: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_subscript"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_subscript">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_subscript</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the subscript elementss.</span>
<span class="sd">            &lt;supscript&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/supscript&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscripts_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In self.handle_tag_subscript: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_operation"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_operation">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_operation</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the operation elementss.</span>
<span class="sd">            &lt;operation&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/operation&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="c1"># A process of negating the operator during goto elimination</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operator&quot;</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_op_negation</span>
            <span class="p">):</span>
                <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;operator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NEGATED_OP</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;operator&#39;</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">need_op_negation</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operand&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;operator&quot;</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_operation: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_operand"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_operand">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_operand</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the operation elementss.</span>
<span class="sd">            &lt;operand&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/operand&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operand_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_operand: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_name_element</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_write"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_write">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_write</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the operation elementss.</span>
<span class="sd">            &lt;operand&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/operand&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-controls&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;outputs&quot;</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_write: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_io_controls"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_io_controls">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_io_controls</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the io-controls elementss.</span>
<span class="sd">            &lt;io-controls&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/io-controls&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-control&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_io_controls: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_io_control"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_io_control">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_io_control</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the io-control elementss.</span>
<span class="sd">            &lt;io-control&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/io-control&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="c1"># To make io-control elements simpler, the code below</span>
            <span class="c1"># will append io-control-spec&#39;s attributes to its</span>
            <span class="c1"># parent (io-control). This will eliminate at least</span>
            <span class="c1"># one recursion in translate.py to retrieve</span>
            <span class="c1"># the io-control information</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-control-spec&quot;</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-control&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_io_control: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_io_control: Empty &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_outputs"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_outputs">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_outputs</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the outputs elementss</span>
<span class="sd">            &lt;outputs&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/outputs&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_outputs: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_output"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_output">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_output</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the output elementss.</span>
<span class="sd">            &lt;output&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/output&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_child_tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_name_element</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_outputs: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_format"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_format">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_format</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the format elementss.</span>
<span class="sd">            &lt;format&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/format&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format-items&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_format: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_format_items"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_format_items">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_format_items</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the format_items and its sub-elementss</span>
<span class="sd">            &lt;format_items&gt;</span>
<span class="sd">                &lt;format_item&gt;</span>
<span class="sd">                    ...</span>
<span class="sd">                &lt;/format_item&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/format_items&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format-items&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format-item&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_format_items: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_print"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_print">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_print</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the print tags.</span>
<span class="sd">            &lt;print&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/print&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s2">&quot;print-stmt&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;outputs&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_print: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_open"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_open">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_open</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the open elementss.</span>
<span class="sd">            &lt;open&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/open&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;keyword-arguments&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_open: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;open-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span><span class="p">,</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_open: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_keyword_arguments"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_keyword_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_keyword_arguments</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elementss between</span>
<span class="sd">            the keyword-arguments and keyword-argument elementss.</span>
<span class="sd">            &lt;keyword-arguments&gt;</span>
<span class="sd">                &lt;keyword-argument&gt;</span>
<span class="sd">                    ...</span>
<span class="sd">                &lt;/keyword-argument&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/keyword-arguments&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;keyword-argument&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_keyword_arguments: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">erro_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_keyword_arguments: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_read"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_read">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_read</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the read elementss.</span>
<span class="sd">            &lt;read&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/read&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-controls&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;inputs&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_read: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;read-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_read: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_inputs"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_inputs</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the inputs and input elementss.</span>
<span class="sd">            &lt;inputs&gt;</span>
<span class="sd">                &lt;input&gt;</span>
<span class="sd">                    ...</span>
<span class="sd">                &lt;/input&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/inputs&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_input - </span><span class="si">{root.tag}</span><span class="s1">: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_input - </span><span class="si">{root.tag}</span><span class="s1">: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_close"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_close">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_close</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the close elementss.</span>
<span class="sd">            &lt;close&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/close&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;keyword-arguments&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_close: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;close-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_close: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_call"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_call">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_call</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the call elements.</span>
<span class="sd">            &lt;call&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/call&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_call: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;call-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_call: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_subroutine"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_subroutine">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_subroutine</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the subroutine elements.</span>
<span class="sd">            &lt;subroutine&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/subroutine&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">current_body_scope</span> <span class="o">=</span> <span class="n">cur_elem</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_subroutine: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unnecessary_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_subroutine: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_arguments"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_arguments</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the arguments.</span>
<span class="sd">            &lt;arguments&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/arsuments&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;argument&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_variable: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_if"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_if">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_if</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the if elements.</span>
<span class="sd">            &lt;if&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/if&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Check and hold conditional operation for &lt;goto-stmt&gt;</span>
                        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operation&quot;</span><span class="p">:</span>
                                    <span class="n">condition</span> <span class="o">=</span> <span class="n">stmt</span>
                        <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span>
                                    <span class="n">condition</span> <span class="o">!=</span> <span class="kc">None</span>
                                    <span class="ow">and</span> <span class="s2">&quot;code&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="p">):</span>
                                <span class="k">assert</span> <span class="p">(</span>
                                        <span class="s2">&quot;conditional-goto-stmt-lbl&quot;</span> <span class="ow">in</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span>
                                <span class="p">),</span> <span class="n">f</span><span class="s2">&quot;If statement must nests conditional goto-stmt&quot;</span>
                                <span class="n">unique_code</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">conditional_op</span><span class="p">[</span><span class="n">unique_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">condition</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_if: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if-stmt&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span> <span class="ow">and</span> <span class="n">traverse</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_if: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

        <span class="c1"># If label appears before &lt;goto&gt;, mark &lt;if&gt;</span>
        <span class="c1"># with goto-move to move it later (1st traverse)</span>
        <span class="k">if</span> <span class="n">traverse</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Since label_after needs to be reconstructed first,</span>
            <span class="c1"># we skip to collect the element if label_after is True</span>
            <span class="c1"># Then, once the reconstruction of label_after is done,</span>
            <span class="c1"># then we collect those reconstructed elements</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                    <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_goto</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                        <span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_stmts_after_label</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                        <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_stop"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_stop">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_stop</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the stop elements</span>
<span class="sd">            &lt;stop&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/stop&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;stop-code&quot;</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_stop: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_step"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_step">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_step</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the step elements.</span>
<span class="sd">            &lt;step&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/step&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operation&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_step: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_step: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_return"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_return">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_return</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the return and return-stmt elementss.</span>
<span class="sd">            However, since &#39;return-stmt&#39; is an empty elements</span>
<span class="sd">            with no sub-elementss, the function will not keep</span>
<span class="sd">            the elements, but move the attribute to its parent</span>
<span class="sd">            elements, return.</span>

<span class="sd">            &lt;return&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/return&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;return-stmt&quot;</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_return: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_function"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_function">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_function</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the function elements.</span>
<span class="sd">            &lt;function&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/function&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_function_arg</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">current_body_scope</span> <span class="o">=</span> <span class="n">cur_elem</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_function: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;function-stmt&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;end-function-stmt&quot;</span>
                        <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;function-subprogram&quot;</span>
                <span class="p">):</span>
                    <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_function: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_use"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_use">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_use</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the use elementss.</span>
<span class="sd">            &lt;use&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/use&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;use-stmt&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;only&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_use: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_module"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_module">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_module</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the module elementss.</span>
<span class="sd">            &lt;module&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/module&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_module: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_initial_value"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_initial_value">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_initial_value</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the initial-value elementss.</span>
<span class="sd">            &lt;initial-value&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/initial-value&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operation&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_initial_value: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;initialization&quot;</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="kc">False</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_initial_value: Empty elements &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_members"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_members">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_members</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the members elementss.</span>
<span class="sd">            &lt;members&gt;       &lt;member&gt;</span>
<span class="sd">                ...     or      ...</span>
<span class="sd">            &lt;/members&gt;      &lt;/member&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_attrib</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">members_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_members: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_only"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_only">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_only</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the only elementss.</span>
<span class="sd">            &lt;only&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/only&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">error_chk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">only_child_tags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_only: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span>

            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.handle_tag_length"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.handle_tag_length">[docs]</a>    <span class="k">def</span> <span class="nf">handle_tag_length</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function handles cleaning up the XML elements</span>
<span class="sd">            between the length elementss.</span>
<span class="sd">            &lt;length&gt;</span>
<span class="sd">                ...</span>
<span class="sd">            &lt;/length&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;char-length&quot;</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="kc">False</span>
                <span class="p">),</span> <span class="n">f</span><span class="s1">&#39;In handle_tag_length: &quot;</span><span class="si">{child.tag}</span><span class="s1">&quot; not handled&#39;</span></div>

    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                       XML TAG PARSER                          #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="RectifyOFPXML.parseXMLTree"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.parseXMLTree">[docs]</a>    <span class="k">def</span> <span class="nf">parseXMLTree</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            parseXMLTree</span>

<span class="sd">            Arguments:</span>
<span class="sd">                root: The current root of the tree.</span>
<span class="sd">                current: Current element.</span>
<span class="sd">                parent: Parent element of the current.</span>
<span class="sd">                grandparent: A parent of parent statement of current.</span>
<span class="sd">                traverse: Keeps the track of number of traverse time.</span>

<span class="sd">            Returns:</span>
<span class="sd">                None</span>

<span class="sd">            Recursively traverse through the nested XML AST tree and</span>
<span class="sd">            calls appropriate tag handler, which will generate</span>
<span class="sd">            a cleaned version of XML tree for translate.py.</span>
<span class="sd">            Any new tags handlers must be added under this this function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_file</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;program&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_program</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;header&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_header</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;specification&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_specification</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                          <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_body</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;declaration&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_declaration</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                        <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_type</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_variables</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_variable</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                     <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;statement&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_statement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;assignment&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_assignment</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                       <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_target</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_value</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;names&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_names</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_name</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_literal</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_dimensions</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                       <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;dimension&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_dimension</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_loop</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;index-variable&quot;</span> <span class="ow">or</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;range&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_index_variable_or_range</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span>
                                                    <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;lower-bound&quot;</span> <span class="ow">or</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;upper-bound&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_bound</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscripts&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_subscripts</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                       <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscript&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_subscript</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_operation</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;operand&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_operand</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;write&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_write</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-controls&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_io_controls</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                        <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;io-control&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_io_control</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                       <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;outputs&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_outputs</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;output&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_output</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_format</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format-items&quot;</span> <span class="ow">or</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;format-item&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_format_items</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                         <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;print&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_print</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;open&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_open</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;keyword-arguments&quot;</span> <span class="ow">or</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;keyword-argument&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_keyword_arguments</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span>
                                              <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;read&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_read</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;inputs&quot;</span> <span class="ow">or</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_inputs</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;close&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_close</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_call</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subroutine&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_subroutine</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                       <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;arguments&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_arguments</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                      <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_if</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_stop</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_step</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;return&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_return</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_function</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                     <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;use&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_use</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;module&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_module</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;initial-value&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_initial_value</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                          <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;members&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_members</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;only&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_only</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_length</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;saved-entity&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_saved_entity</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                    <span class="n">traverse</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;save-stmt&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_tag_save_statement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span>
                                     <span class="n">traverse</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="kc">False</span>
            <span class="p">),</span> <span class="n">f</span><span class="s2">&quot;In the parseXMLTree. Currently, &lt;</span><span class="si">{root.tag}</span><span class="s2">&gt; passed from &lt;</span><span class="si">{parent.tag}</span><span class="s2">&gt; is not supported&quot;</span></div>

    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                       RECONSTRUCTORS                          #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="RectifyOFPXML.reconstruct_derived_type_declaration"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.reconstruct_derived_type_declaration">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_derived_type_declaration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function reconstructs the derived type</span>
<span class="sd">            with the collected derived type declaration</span>
<span class="sd">            elements in the handle_tag_declaration and</span>
<span class="sd">            handle_tag_type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">:</span>
            <span class="n">literal</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">is_dimension</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Since component-decl-list appears after component-decl,</span>
            <span class="c1"># the program needs to iterate the list once first to</span>
            <span class="c1"># pre-collect the variable counts.</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl-list&quot;</span><span class="p">:</span>
                    <span class="n">counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>

            <span class="c1"># Initialize count to 0 for &lt;variables&gt; count attribute.</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># &#39;component-decl-list__begin&#39; tag is an indication</span>
            <span class="c1"># of all the derived type member variable</span>
            <span class="c1"># declarations will follow.</span>
            <span class="n">derived_type</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_type</span><span class="p">,</span> <span class="s2">&quot;derived-types&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;intrinsic-type-spec&quot;</span><span class="p">:</span>
                    <span class="n">keyword2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">keyword2</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">keyword2</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword2&#39;</span><span class="p">]</span>
                    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;hasKind&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;hasLength&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;keyword1&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;is_derived_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">),</span>
                        <span class="s2">&quot;keyword2&quot;</span><span class="p">:</span> <span class="n">keyword2</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">newType</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">derived_type</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;derived-type-spec&quot;</span><span class="p">:</span>
                    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;hasKind&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;hasLength&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;typeName&#39;</span><span class="p">],</span>
                        <span class="s2">&quot;is_derived_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type</span><span class="p">),</span>
                        <span class="s2">&quot;keyword2&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">newType</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">derived_type</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                    <span class="n">literal</span> <span class="o">=</span> <span class="n">elem</span>
                <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-array-spec&quot;</span><span class="p">:</span>
                    <span class="n">is_dimension</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;component-decl&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimension</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">count</span><span class="p">:</span>
                            <span class="n">attr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">counts</span><span class="p">[</span><span class="n">count</span><span class="p">]}</span>
                            <span class="n">new_variables</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                <span class="n">derived_type</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">,</span> <span class="n">attr</span>
                            <span class="p">)</span>  <span class="c1"># &lt;variables _attribs_&gt;</span>
                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">var_attribs</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;has_initial_value&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                <span class="s2">&quot;hasComponentInitialization&quot;</span>
                            <span class="p">],</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                            <span class="s2">&quot;is_array&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="c1"># Store variable name in the non array tracker</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">declared_non_array_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="p">{</span><span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">}</span>
                        <span class="p">)</span>
                        <span class="n">new_variable</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">new_variables</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">var_attribs</span>
                        <span class="p">)</span>  <span class="c1"># &lt;variable _attribs_&gt;</span>
                        <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasComponentInitialization&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                            <span class="n">init_value_attrib</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                <span class="n">new_variable</span><span class="p">,</span> <span class="s2">&quot;initial-value&quot;</span>
                            <span class="p">)</span>
                            <span class="n">new_literal</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                <span class="n">init_value_attrib</span><span class="p">,</span> <span class="s2">&quot;literal&quot;</span><span class="p">,</span> <span class="n">literal</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="p">)</span>  <span class="c1"># &lt;initial-value _attribs_&gt;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_dimensions</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">derived_type</span><span class="p">,</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">}</span>
                        <span class="p">)</span>  <span class="c1"># &lt;dimensions count=&quot;1&quot;&gt;</span>
                        <span class="n">new_dimension</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">new_dimensions</span><span class="p">,</span> <span class="s2">&quot;dimension&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;simple&quot;</span><span class="p">}</span>
                        <span class="p">)</span>  <span class="c1"># &lt;dimension type=&quot;simple&quot;&gt;</span>
                        <span class="n">new_literal</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">new_dimension</span><span class="p">,</span> <span class="s2">&quot;literal&quot;</span><span class="p">,</span> <span class="n">literal</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="p">)</span>  <span class="c1"># &lt;literal type=&quot;&quot; value=&quot;&quot;&gt;</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">count</span><span class="p">:</span>
                            <span class="n">attr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">counts</span><span class="p">[</span><span class="n">count</span><span class="p">]}</span>
                            <span class="n">new_variables</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                <span class="n">derived_type</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">,</span> <span class="n">attr</span>
                            <span class="p">)</span>
                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">var_attribs</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;has_initial_value&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                <span class="s2">&quot;hasComponentInitialization&quot;</span>
                            <span class="p">],</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                            <span class="s2">&quot;is_array&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="c1"># Store variable name in the array tracker</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="p">{</span><span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span><span class="p">}</span>
                        <span class="p">)</span>
                        <span class="n">new_variable</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                            <span class="n">new_variables</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">var_attribs</span>
                        <span class="p">)</span>
                        <span class="n">is_dimension</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Once one derived type was successfully constructed,</span>
            <span class="c1"># clear all the elementss of a derived type list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="RectifyOFPXML.reconstruct_derived_type_ref"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.reconstruct_derived_type_ref">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_derived_type_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function reconstruct the id into x.y.k form</span>
<span class="sd">            from the messy looking id. One thing to notice is</span>
<span class="sd">            that this new form was generated in the python syntax,</span>
<span class="sd">            so it is a pre-process for translate.py and</span>
<span class="sd">            even pyTranslate.py that</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="n">current</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span>
        <span class="p">),</span> <span class="n">f</span><span class="s2">&quot;The tag &lt;name&gt; must be passed to reconstruct_derived_type_ref.</span><span class="se">\</span>
<span class="s2">             Currently, it&#39;s </span><span class="si">{current.tag}</span><span class="s2">.&quot;</span>
        <span class="c1"># First the root &lt;name&gt; id gets the very first</span>
        <span class="c1"># variable reference i.e. x in x.y.k (or x%y%k in Fortran syntax)</span>
        <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="p">[</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span>
                <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span>
        <span class="p">):</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
            <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>

        <span class="n">number_of_vars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">)</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">parent_ref</span> <span class="o">=</span> <span class="n">current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent_ref</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_vars</span><span class="p">):</span>
            <span class="n">variable_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
            <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variable_name</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">variable_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_array_vars</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>
                    <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_scope</span>
            <span class="p">):</span>
                <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;is_array&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span>
            <span class="c1"># Create N (number_of_vars) number of new subElement</span>
            <span class="c1"># under the root &lt;name&gt; for each referencing variable</span>
            <span class="n">reference_var</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">parent_ref</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">attributes</span>
            <span class="p">)</span>
            <span class="n">parent_ref</span> <span class="o">=</span> <span class="n">reference_var</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent_ref</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clean up the list for re-use</span></div>

<div class="viewcode-block" id="RectifyOFPXML.reconstruct_format"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.reconstruct_format">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function is for reconstructing the &lt;format&gt;</span>
<span class="sd">            under the &lt;statement&gt; element.</span>
<span class="sd">            The OFP XML nests formats under:</span>
<span class="sd">                (1) statement</span>
<span class="sd">                (2) declaration</span>
<span class="sd">                (3) loop</span>
<span class="sd">            tags, which are wrong except one that is declared</span>
<span class="sd">            under the statement. Therefore, those formats</span>
<span class="sd">            declared under (2) and (3) will be extracted</span>
<span class="sd">            and reconstructed to be nested under (1)</span>
<span class="sd">            in this function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">statement_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_body_scope</span><span class="p">,</span> <span class="s2">&quot;statement&quot;</span><span class="p">)</span>
        <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">statement_elem</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format_holder</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">statement_elem</span><span class="p">,</span> <span class="n">grandparent</span><span class="p">,</span> <span class="n">traverse</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.reconstruct_derived_type_names"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.reconstruct_derived_type_names">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_derived_type_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function reconstructs derived type</span>
<span class="sd">            reference syntax tree. However, this functions is</span>
<span class="sd">            actually a preprocessor for the real final reconstruction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update reconstruced derived type references</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_derived_type_ref</span> <span class="o">==</span> <span class="kc">True</span>
        <span class="p">),</span> <span class="s2">&quot;&#39;self.is_derived_type_ref&#39; must be true&quot;</span>
        <span class="n">numPartRef</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;numPartRef&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;numPartRef&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">numPartRef</span><span class="p">)}</span>
            <span class="p">)</span>
        <span class="c1"># Re-initialize to original values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_refs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="RectifyOFPXML.reconstruct_name_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.reconstruct_name_element">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_name_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function performs a final reconstruction of</span>
<span class="sd">            derived type name element that was preprocessed by</span>
<span class="sd">            &#39;reconstruct_derived_type_names&#39; function.</span>
<span class="sd">            This function traverses the preprocessed name element</span>
<span class="sd">            (including sub-elements) and split &amp; store &lt;name&gt; and</span>
<span class="sd">            &lt;subscripts&gt; into separate lists. Then, it comibines</span>
<span class="sd">            and reconstructs two lists appropriately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">cur_elem</span><span class="p">]</span>
        <span class="c1"># Remove the original &lt;name&gt; elements.</span>
        <span class="n">current</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">)</span>
        <span class="c1"># Split &amp; Store &lt;name&gt; element and &lt;subscripts&gt;.</span>
        <span class="n">subscripts_holder</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;subscripts&quot;</span><span class="p">:</span>
                <span class="n">subscripts_holder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">third</span> <span class="ow">in</span> <span class="n">child</span><span class="p">:</span>
                    <span class="n">name_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">third</span><span class="p">)</span>

        <span class="c1"># Combine &amp; Reconstruct &lt;name&gt; element.</span>
        <span class="n">subscript_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">current</span><span class="p">,</span> <span class="n">name_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">name_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span>
        <span class="p">)</span>
        <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_derived_type_ref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
        <span class="k">if</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="n">cur_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subscripts_holder</span><span class="p">[</span><span class="n">subscript_num</span><span class="p">])</span>
            <span class="n">subscript_num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">numPartRef</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;numPartRef&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">name_element</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_elements</span><span class="p">)):</span>
            <span class="n">name_elements</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;numPartRef&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numPartRef</span><span class="p">)</span>
            <span class="n">numPartRef</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">name_element</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">cur_elem</span><span class="p">,</span> <span class="n">name_elements</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">name_elements</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="n">name_element</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;is_derived_type_ref&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
            <span class="c1"># In order to handle the nested subelements of &lt;name&gt;,</span>
            <span class="c1"># update the cur_elem at each iteration.</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">name_element</span>
            <span class="k">if</span> <span class="n">name_elements</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;hasSubscripts&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="n">name_element</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subscripts_holder</span><span class="p">[</span><span class="n">subscript_num</span><span class="p">])</span>
                <span class="n">subscript_num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Clean out the lists for recyling.</span>
        <span class="c1"># This is not really needed as they are local lists,</span>
        <span class="c1"># but just in case.</span>
        <span class="n">name_elements</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">subscripts_holder</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">need_reconstruct</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="RectifyOFPXML.reconstruct_goto_after_label"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.reconstruct_goto_after_label">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_goto_after_label</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstruct_target</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function gets called when goto appears</span>
<span class="sd">            after the corresponding label and all necessary</span>
<span class="sd">            statements are collected for the reconstruction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">number_of_gotos</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span>
        <span class="n">stmts_follow_goto</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span>

        <span class="n">conditional_goto</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">uniq_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_goto</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;statement&quot;</span>
                    <span class="ow">and</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="ow">and</span> <span class="s2">&quot;conditional-goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">):</span>
                <span class="n">uniq_code</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
                <span class="n">conditional_goto</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span>
                    <span class="ow">and</span> <span class="s2">&quot;conditional-goto-stmt-lbl&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="ow">and</span> <span class="n">uniq_code</span> <span class="o">==</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">header</span> <span class="o">=</span> <span class="n">stmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">stmts_follow_goto</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

        <span class="n">stmts_follow_label</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span>

        <span class="c1"># If [0] &lt;goto-stmt&gt; is an inner scope statement of the [N-1]</span>
        <span class="c1"># &lt;goto-stmt&gt; (if it is a &lt;goto-stmt&gt; in the stmts_follow_goto,</span>
        <span class="c1"># then we need to correct the scoping issue by moving</span>
        <span class="c1"># the [N-1] element to the end of stmts_follow_label</span>
        <span class="n">last_stmt</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">last_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">first_goto</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">last_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">first_goto</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]:</span>
                <span class="n">last_goto</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">last_goto</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;next-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                <span class="n">stmts_follow_label</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_goto</span><span class="p">)</span>

        <span class="n">goto_and_label_stmts_after_goto</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_goto</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">goto_and_label_stmts_after_goto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">goto_and_label_stmts_after_goto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">])</span>

        <span class="n">num_of_goto_and_label_after_label</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_label</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="ow">or</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">):</span>
                <span class="n">num_of_goto_and_label_after_label</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Since the first label-statement of</span>
                <span class="c1"># stmts_follow_label is always a match</span>
                <span class="c1"># for the first goto-statement in the</span>
                <span class="c1"># stmt_follow_goto in the label_after case,</span>
                <span class="c1"># remove the goto-move (label_before) case mark</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span>
                        <span class="ow">and</span> <span class="s2">&quot;goto-move&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">):</span>
                    <span class="k">del</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span>

        <span class="c1"># -2 disregarding the first and last statements</span>
        <span class="n">num_of_goto_and_label_after_label</span> <span class="o">-=</span> <span class="mi">2</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_of_goto_and_label_after_label</span><span class="p">):</span>
            <span class="n">stmt</span> <span class="o">=</span> <span class="n">stmts_follow_label</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">stmts_follow_goto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">conditional_goto</span><span class="p">:</span>
            <span class="n">declared_goto_flag_num</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_declaration_element</span><span class="p">(</span>
                <span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;goto_flag&quot;</span><span class="p">,</span> <span class="n">number_of_gotos</span><span class="p">,</span> <span class="n">declared_goto_flag_num</span><span class="p">,</span>
                <span class="n">traverse</span>
            <span class="p">)</span>

        <span class="c1"># This variable is for storing goto that may appear at the end of if</span>
        <span class="c1"># because we want to extract one scope out and place it right</span>
        <span class="c1"># after the constructed if-statement</span>
        <span class="n">next_goto</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">reconstructed_if_elem</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gotos</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">conditional_goto</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">header</span> <span class="o">!=</span> <span class="kc">None</span>
                <span class="p">),</span> <span class="s2">&quot;Header cannot be None in case of conditional goto&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">need_op_negation</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generate_if_element</span><span class="p">(</span>
                    <span class="n">header</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">stmts_follow_goto</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">f</span><span class="s2">&quot;goto_flag_{i + 1}&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span>
                    <span class="n">reconstructed_if_elem</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">reconstructed_if_elem</span><span class="p">:</span>
                    <span class="n">stmts_follow_goto</span> <span class="o">=</span> <span class="n">reconstructed_if_elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">need_op_negation</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generate_if_element</span><span class="p">(</span>
                    <span class="n">header</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">stmts_follow_label</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">f</span><span class="s2">&quot;goto_flag_{i + 1}&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span>
                    <span class="n">reconstructed_if_elem</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reconstructed_if_elem</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">stmts_follow_label</span> <span class="o">=</span> <span class="n">reconstructed_if_elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">conditional_goto</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generate_if_element</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">stmts_follow_goto</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;unary&quot;</span><span class="p">,</span>
                    <span class="n">f</span><span class="s2">&quot;goto_flag_{i + 1}&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;.not.&quot;</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span>
                    <span class="n">reconstructed_if_elem</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">reconstructed_if_elem</span><span class="p">:</span>
                    <span class="n">stmts_follow_goto</span> <span class="o">=</span> <span class="n">reconstructed_if_elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generate_if_element</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">stmts_follow_label</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">f</span><span class="s2">&quot;goto_flag_{i + 1}&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span>
                    <span class="n">reconstructed_if_elem</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reconstructed_if_elem</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">stmts_follow_label</span> <span class="o">=</span> <span class="n">reconstructed_if_elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">next_goto</span><span class="p">:</span>
                <span class="n">statement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">parent</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                    <span class="n">next_goto</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="n">goto_stmt</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">statement</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;goto-stmt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                    <span class="n">next_goto</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;goto-stmt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">reconstructed_if_elem</span>
                        <span class="ow">and</span> <span class="n">reconstructed_if_elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                        <span class="o">==</span> <span class="n">goto_stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">reconstructed_if_elem</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                            <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                        <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_before_case_now</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_before_done</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Set all holders and checkers (markers) to default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_after</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_after_case_now</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruction_for_after_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_after</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="RectifyOFPXML.reconstruct_goto_before_label"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.reconstruct_goto_before_label">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_goto_before_label</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstruct_target</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function gets called when goto appears</span>
<span class="sd">            before the corresponding label and all necessary</span>
<span class="sd">            statements are collected for the reconstruction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stmts_follow_label</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span>
        <span class="n">number_of_gotos</span> <span class="o">=</span> <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span>

        <span class="n">declared_label_flag_num</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_declaration_element</span><span class="p">(</span>
            <span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;label_flag&quot;</span><span class="p">,</span> <span class="n">number_of_gotos</span><span class="p">,</span>
            <span class="n">declared_label_flag_num</span><span class="p">,</span> <span class="n">traverse</span>
        <span class="p">)</span>

        <span class="c1"># Find the scope from label to goto.</span>
        <span class="c1"># Remove any statements that are not within the scope.</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">goto_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">goto_index_holder</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">target_label_lbl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stmts_follow_label</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span>
                    <span class="ow">and</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">):</span>
                <span class="n">target_label_lbl</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;goto-stmt&quot;</span>
                        <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_label_lbl</span>
                <span class="p">):</span>
                    <span class="n">goto_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">goto_index_holder</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">goto_counter</span> <span class="o">==</span> <span class="n">number_of_gotos</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Store statements that are outside of</span>
        <span class="c1"># the label-goto scope in a separate list,</span>
        <span class="c1"># which will then be used to recover the syntax</span>
        <span class="c1"># after the elimination process is done</span>
        <span class="n">statements_to_recover</span> <span class="o">=</span> <span class="n">stmts_follow_label</span><span class="p">[</span>
                                <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">stmts_follow_label</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">statements_to_recover</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;if&quot;</span>
                    <span class="ow">and</span> <span class="s2">&quot;conditional-goto-stmt-lbl&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">):</span>
                <span class="n">statements_to_recover</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">stmts_follow_label</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">stmts_follow_label</span><span class="p">)]</span>

        <span class="c1"># In case of multiple goto statements appears,</span>
        <span class="c1"># slice them into N number of list objects</span>
        <span class="c1"># The location of goto statement (inner to outer)</span>
        <span class="c1"># is represented by the increament of index</span>
        <span class="c1"># i.e. [0]: innermost, [N]: Outermost</span>
        <span class="n">multiple_goto_stmts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">goto_index_holder</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">multiple_goto_stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">stmts_follow_label</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">goto_index_holder</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">goto_index_holder</span><span class="p">):</span>
                    <span class="n">multiple_goto_stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">stmts_follow_label</span><span class="p">[</span>
                        <span class="n">goto_index_holder</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">goto_index_holder</span><span class="p">[</span>
                                                         <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">multiple_goto_stmts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">stmts_follow_label</span><span class="p">[</span>
                        <span class="n">goto_index_holder</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">goto_index_holder</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>

        <span class="c1"># Check whether there is inner label_after</span>
        <span class="c1"># case goto statements. Handles one case</span>
        <span class="c1"># at a time</span>
        <span class="n">inner_gotos_exist</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">index_scope</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">goto</span> <span class="ow">in</span> <span class="n">multiple_goto_stmts</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">main_loop_lbl</span> <span class="o">=</span> <span class="n">goto</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="n">label_after_lbl</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">goto</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">label_after_lbl</span><span class="p">:</span>
                        <span class="n">index_scope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                            <span class="n">main_loop_lbl</span> <span class="o">!=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                            <span class="ow">and</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span>
                    <span class="p">):</span>
                        <span class="n">inner_gotos_exist</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">label_after_lbl</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                        <span class="n">index_scope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Generate loop ast</span>
        <span class="n">cur_elem_parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="n">current_goto_num</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">end_of_current_goto_loop</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gotos</span><span class="p">):</span>
            <span class="n">loop_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">cur_elem_parent</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">,</span>
                                      <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;do-while&quot;</span><span class="p">})</span>

            <span class="n">header_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">loop_elem</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">)</span>
            <span class="c1"># The outermost flag == N and the innermost flag == 1</span>
            <span class="n">flag_num</span> <span class="o">=</span> <span class="n">declared_label_flag_num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;label_flag_{str(flag_num)}&quot;</span>
            <span class="n">name_attrib</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;hasSubscripts&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ambiguous&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">name_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header_elem</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">name_attrib</span><span class="p">)</span>
            <span class="n">flag_name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">body_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">loop_elem</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">)</span>
            <span class="c1"># Keep a track of the parent and grandparent elements</span>
            <span class="n">grand_parent_elem</span> <span class="o">=</span> <span class="n">cur_elem_parent</span>
            <span class="n">cur_elem_parent</span> <span class="o">=</span> <span class="n">body_elem</span>
            <span class="c1"># Since reconstruction of multiple goto is done from outermost</span>
            <span class="c1"># to the inner, we are not constructing any subelements until</span>
            <span class="c1"># all encapsulating loops are created first</span>
            <span class="k">if</span> <span class="n">current_goto_num</span> <span class="o">==</span> <span class="n">number_of_gotos</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">statements</span> <span class="ow">in</span> <span class="n">multiple_goto_stmts</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">statements</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">inner_gotos_exist</span><span class="p">:</span>
                                <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span> \
                                    <span class="o">=</span> <span class="n">statements</span><span class="p">[</span><span class="n">index_scope</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">index_scope</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                                <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span> \
                                    <span class="o">=</span> <span class="n">statements</span><span class="p">[</span><span class="n">index_scope</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                                <span class="n">reconstruct_target</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> \
                                    <span class="o">=</span> <span class="mi">1</span>

                                <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_goto_after_label</span><span class="p">(</span>
                                    <span class="n">body_elem</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstruct_target</span>
                                <span class="p">)</span>

                                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span>
                                    <span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                <span class="c1"># self.statements_to_reconstruct_after[&#39;stmts-follow-label&#39;] = stmts_follow_label_copy</span>
                                <span class="n">inner_gotos_exist</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">elems</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                    <span class="n">body_elem</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                                <span class="p">)</span>
                                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="p">(</span>
                                            <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;goto-stmt&quot;</span>
                                            <span class="ow">and</span> <span class="n">target_label_lbl</span> <span class="o">==</span>
                                            <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]</span>
                                    <span class="p">):</span>
                                        <span class="c1"># Conditional</span>
                                        <span class="k">if</span> <span class="s2">&quot;conditional-goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assignment_element</span><span class="p">(</span>
                                                <span class="n">elems</span><span class="p">,</span> <span class="n">flag_name</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">conditional_op</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                                <span class="n">traverse</span>
                                            <span class="p">)</span>
                                        <span class="c1"># Unconditional</span>
                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assignment_element</span><span class="p">(</span>
                                                <span class="n">elems</span><span class="p">,</span> <span class="n">flag_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                                <span class="s2">&quot;literal&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="n">traverse</span>
                                            <span class="p">)</span>
                                        <span class="n">end_of_current_goto_loop</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">child_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                                            <span class="n">elems</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                                        <span class="p">)</span>
                                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                                                <span class="n">child</span><span class="p">,</span> <span class="n">child_elem</span><span class="p">,</span> <span class="n">elems</span><span class="p">,</span>
                                                <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                                            <span class="p">)</span>
                        <span class="c1"># If end_of_current_goto_loop is True,</span>
                        <span class="c1"># escape one loop out to continue</span>
                        <span class="c1"># construct statements</span>
                        <span class="k">if</span> <span class="n">end_of_current_goto_loop</span><span class="p">:</span>
                            <span class="n">body_elem</span> <span class="o">=</span> <span class="n">grand_parent_elem</span>
                            <span class="n">end_of_current_goto_loop</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">flag_name</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;label_flag_&quot;</span> \
                                <span class="n">f</span><span class="s2">&quot;{str(number_of_gotos + i - 1)}&quot;</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current_goto_num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">recover_stmt</span> <span class="ow">in</span> <span class="n">statements_to_recover</span><span class="p">:</span>
            <span class="n">statement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">parent</span><span class="p">,</span> <span class="n">recover_stmt</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">recover_stmt</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">recover_stmt</span><span class="p">:</span>
                <span class="n">child_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                    <span class="n">statement</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                        <span class="n">child</span><span class="p">,</span> <span class="n">child_elem</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">traverse</span>
                    <span class="p">)</span>

        <span class="c1"># Set all holders and checkers (markers) to default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_before</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_before_case_now</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_lbl_for_before</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="RectifyOFPXML.reconstruct_header"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.reconstruct_header">[docs]</a>    <span class="k">def</span> <span class="nf">reconstruct_header</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">temp_elem_holder</span><span class="p">,</span> <span class="n">parent</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function is for reconstructing the oddly</span>
<span class="sd">            generated header AST to have an uniform structure</span>
<span class="sd">            with other multiary type operation nested headers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This operation is basically for switching</span>
        <span class="c1"># the location of operator and 2nd operand,</span>
        <span class="c1"># so the output syntax can have a common structure</span>
        <span class="c1"># with other operation AST</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">temp_elem_holder</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">temp_elem_holder</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>

        <span class="c1"># First create &lt;operation&gt; element</span>
        <span class="c1"># Currently, only assume multiary reconstruction</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;multiary&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">temp_elem_holder</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;name&quot;</span> <span class="ow">or</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
                <span class="n">operand</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="s2">&quot;operand&quot;</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;equiv-operand__equiv-op&quot;</span> 
                <span class="p">),</span> <span class="n">f</span><span class="s2">&quot;Tag must be &#39;equiv-operand__equiv-op&#39;. Current: </span><span class="si">{elem.tag}</span><span class="s2">.&quot;</span>
                <span class="n">operator</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                        <span class="n">operation</span><span class="p">,</span> <span class="s2">&quot;operator&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;operator&quot;</span><span class="p">:</span><span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;equivOp&#39;</span><span class="p">]}</span>
                <span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span></div>


    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                       ELEMENT GENERATORS                      #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="RectifyOFPXML.generate_declaration_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.generate_declaration_element">[docs]</a>    <span class="k">def</span> <span class="nf">generate_declaration_element</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">default_name</span><span class="p">,</span> <span class="n">number_of_gotos</span><span class="p">,</span>
            <span class="n">declared_flag_num</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            A flag declaration and assignment xml generation.</span>
<span class="sd">            This will generate N number of label_flag_i or goto_i,</span>
<span class="sd">            where N is the number of gotos in the Fortran code</span>
<span class="sd">            and i is the number assigned to the flag</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Declaration</span>
        <span class="n">specification_attribs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;declaration&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;implicit&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;imports&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uses&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span>
        <span class="p">}</span>
        <span class="n">specification_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;specification&quot;</span><span class="p">,</span> <span class="n">specification_attribs</span>
        <span class="p">)</span>
        <span class="n">declaration_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">specification_elem</span><span class="p">,</span> <span class="s2">&quot;declaration&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;variable&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">type_attribs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;hasKind&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasLength&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_derived_type&quot;</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span>
            <span class="s2">&quot;keyword2&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;logical&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">type_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">declaration_elem</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">type_attribs</span>
        <span class="p">)</span>
        <span class="n">variables_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
            <span class="n">declaration_elem</span><span class="p">,</span>
            <span class="s2">&quot;variables&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">number_of_gotos</span><span class="p">)}</span>
        <span class="p">)</span>
        <span class="n">variable_attribs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;hasArraySpec&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasCharLength&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasCoarraySpec&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasInitialValue&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hasInitialization&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_array&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gotos</span><span class="p">):</span>
            <span class="n">flag_num</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">default_name</span> <span class="o">==</span> <span class="s2">&quot;label_flag&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">flag_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_label_flags</span><span class="p">:</span>
                    <span class="n">flag_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_label_flags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">default_name</span> <span class="o">==</span> <span class="s2">&quot;goto_flag&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">flag_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_goto_flags</span><span class="p">:</span>
                    <span class="n">flag_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">declared_goto_flags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">declared_label_flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag_num</span><span class="p">)</span>
            <span class="n">declared_flag_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag_num</span><span class="p">)</span>
            <span class="n">variable_attribs</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{default_name}</span><span class="s2">_</span><span class="si">{flag_num}</span><span class="s2">&quot;</span>
            <span class="n">variable_attribs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{default_name}</span><span class="s2">_</span><span class="si">{flag_num}</span><span class="s2">&quot;</span>
            <span class="n">variable_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">variables_elem</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">variable_attribs</span>
            <span class="p">)</span>

        <span class="c1"># Assignment</span>
        <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_gotos</span><span class="p">):</span>
            <span class="n">flag_num</span> <span class="o">=</span> <span class="n">declared_flag_num</span><span class="p">[</span><span class="n">flag</span><span class="p">]</span>
            <span class="n">declared_flag_num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flag_num</span><span class="p">)</span>
            <span class="n">statement_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;statement&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assignment_element</span><span class="p">(</span>
                <span class="n">statement_elem</span><span class="p">,</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{default_name}</span><span class="s2">_</span><span class="si">{flag_num}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
                <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="n">traverse</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.generate_assignment_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.generate_assignment_element">[docs]</a>    <span class="k">def</span> <span class="nf">generate_assignment_element</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">value_type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traverse</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This is a function for generating new assignment element xml</span>
<span class="sd">            for goto reconstruction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assignment_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;assignment&quot;</span><span class="p">)</span>
        <span class="n">target_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">assignment_elem</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generate_name_element</span><span class="p">(</span>
            <span class="n">target_elem</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span>
        <span class="p">)</span>

        <span class="n">value_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">assignment_elem</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="c1"># Unconditional goto has default values of literal as below</span>
        <span class="k">if</span> <span class="n">value_type</span> <span class="o">==</span> <span class="s2">&quot;literal&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">condition</span> <span class="o">==</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="s2">&quot;Literal type assignment must not hold condition element.&quot;</span>
            <span class="n">literal_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">value_elem</span><span class="p">,</span> <span class="s2">&quot;literal&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="c1"># Conditional goto has dynamic values of operation</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">condition</span> <span class="o">!=</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="s2">&quot;Conditional &lt;goto-stmt&gt; assignment must be passed with operation.&quot;</span>
            <span class="n">unique_code</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
            <span class="n">condition_op</span> <span class="o">=</span> <span class="n">condition</span><span class="p">[</span><span class="n">unique_code</span><span class="p">]</span>
            <span class="n">operation_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">value_elem</span><span class="p">,</span> <span class="n">condition_op</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">condition_op</span><span class="o">.</span><span class="n">attrib</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span>
                <span class="n">condition_op</span><span class="p">,</span> <span class="n">operation_elem</span><span class="p">,</span>
                <span class="n">value_elem</span><span class="p">,</span> <span class="n">assignment_elem</span><span class="p">,</span>
                <span class="n">traverse</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.generate_operation_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.generate_operation_element">[docs]</a>    <span class="k">def</span> <span class="nf">generate_operation_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">op_type</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This is a function for generating new operation element and</span>
<span class="sd">            its nested subelements with the passes arguments.</span>

<span class="sd">            Currently, it generates only a unary operation syntax only.</span>
<span class="sd">            It may require update in the future.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operation_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;operation&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">op_type</span><span class="p">})</span>
        <span class="n">operator_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">operation_elem</span><span class="p">,</span> <span class="s2">&quot;operator&quot;</span><span class="p">,</span>
                                      <span class="p">{</span><span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="p">})</span>
        <span class="n">operand_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">operation_elem</span><span class="p">,</span> <span class="s2">&quot;operand&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generate_name_element</span><span class="p">(</span><span class="n">operand_elem</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                   <span class="s2">&quot;ambiguous&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.generate_name_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.generate_name_element">[docs]</a>    <span class="k">def</span> <span class="nf">generate_name_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">hasSubscripts</span><span class="p">,</span> <span class="n">name_id</span><span class="p">,</span> <span class="n">is_array</span><span class="p">,</span>
                              <span class="n">numPartRef</span><span class="p">,</span> <span class="n">name_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This is a function for generating new name element based on</span>
<span class="sd">            the provided arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name_attribs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;hasSubscripts&quot;</span><span class="p">:</span> <span class="n">hasSubscripts</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">name_id</span><span class="p">,</span>
            <span class="s2">&quot;is_array&quot;</span><span class="p">:</span> <span class="n">is_array</span><span class="p">,</span>
            <span class="s2">&quot;numPartRef&quot;</span><span class="p">:</span> <span class="n">numPartRef</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">name_type</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">name_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">name_attribs</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.generate_if_element"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.generate_if_element">[docs]</a>    <span class="k">def</span> <span class="nf">generate_if_element</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">stored_stmts</span><span class="p">,</span> <span class="n">next_goto</span><span class="p">,</span>
            <span class="n">need_operation</span><span class="p">,</span> <span class="n">op_type</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span>
            <span class="n">traverse</span><span class="p">,</span> <span class="n">reconstructed_if_elem</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This is a function generating new if element.</span>
<span class="sd">            Since header can hold unary, multiary, or name, some arguments</span>
<span class="sd">            may be passed with None. Check them to generate an appropriate XML.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">goto_nest_if_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;if&quot;</span><span class="p">)</span>

        <span class="n">header_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">goto_nest_if_elem</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">need_operation</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generate_operation_element</span><span class="p">(</span><span class="n">header_elem</span><span class="p">,</span> <span class="n">op_type</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span>
                                                <span class="n">lhs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                    <span class="n">operation_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">header_elem</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                                   <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">operation_elem</span><span class="p">,</span> <span class="n">header_elem</span><span class="p">,</span>
                                      <span class="n">goto_nest_if_elem</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_name_element</span><span class="p">(</span><span class="n">header_elem</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                       <span class="s2">&quot;variable&quot;</span><span class="p">)</span>

        <span class="c1"># Generate AST for statements that will be nested under if (!cond) or (cond)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">statement_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">label_before_within_scope</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">body_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">goto_nest_if_elem</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">stored_stmts</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;skip-collect&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="n">parent_scope</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">parent_scope</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">[</span><span class="n">parent_scope</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;before&quot;</span><span class="p">:</span>
                            <span class="n">goto_nest_if_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_scope</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="s2">&quot;next-goto&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                        <span class="ow">or</span> <span class="p">(</span>
                            <span class="s2">&quot;lbl&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span>
                            <span class="ow">and</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span>
                        <span class="p">)</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="s2">&quot;goto-move&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">label_before_within_scope</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s2">&quot;target-label-statement&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                <span class="k">del</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span>
                                <span class="k">del</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target-label-statement&#39;</span><span class="p">]</span>
                                <span class="n">label_before_within_scope</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="c1"># If label for label-before case is the first statement,</span>
                                <span class="c1"># we want to mark this entire if-statement because it</span>
                                <span class="c1"># represents that it needs to be encapsulated with do-while</span>
                                <span class="k">if</span> <span class="n">statement_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="c1"># Reinitialize counter to 0 to count the number of gotos</span>
                                <span class="c1"># only within the current scope</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">label_before_within_scope</span><span class="p">:</span>
                            <span class="c1"># del stmt.attrib[&#39;goto-remove&#39;]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span>
                                <span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
                                    <span class="n">label</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
                                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span><span class="p">:</span>
                                            <span class="n">goto_nest_if_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                                <span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
                                <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;goto-stmt&quot;</span><span class="p">:</span>
                                    <span class="c1"># If current goto-stmt label is equal to the scope label,</span>
                                    <span class="c1"># it means that end-of-scope is met and ready to reconstruct</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span> <span class="o">==</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;target_label&#39;</span><span class="p">]:</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;count-gotos&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="c1"># Since we are going to handle the first label-before</span>
                                        <span class="c1"># case, remove the label lbl from the list</span>
                                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_before</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="n">label_before_within_scope</span> <span class="o">=</span> <span class="kc">False</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span> <span class="o">=</span> <span class="kc">None</span>

                                        <span class="n">reconstruct_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_goto_before_label</span><span class="p">(</span>
                                            <span class="n">body_elem</span><span class="p">,</span> <span class="n">traverse</span><span class="p">,</span>
                                            <span class="n">reconstruct_target</span><span class="p">)</span>

                                    <span class="c1"># Else, a new goto-stmt was found that is nested current label_before</span>
                                    <span class="c1"># case scope, so we need to update the parent for it</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_label</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">body_elem</span><span class="p">,</span> <span class="n">stmt</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                                     <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                            <span class="k">if</span> <span class="s2">&quot;goto-remove&quot;</span> <span class="ow">in</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                                <span class="k">del</span> <span class="n">cur_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-remove&#39;</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                                <span class="n">child_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">cur_elem</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                                                           <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">child_elem</span><span class="p">,</span>
                                                      <span class="n">cur_elem</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span>
                                                      <span class="n">traverse</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">goto_stmt</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stmt</span>
                        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">stmt</span><span class="p">:</span>
                            <span class="k">assert</span> <span class="p">(</span>
                                    <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;goto-stmt&quot;</span>
                            <span class="p">),</span> <span class="n">f</span><span class="s2">&quot;Must only store &lt;goto-stmt&gt; in next_goto[&#39;goto-stmt&#39;]. Current: &lt;</span><span class="si">{child.tag}</span><span class="s2">&gt;.&quot;</span>
                            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                <span class="s1">&#39;target_label&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_before</span><span class="p">:</span>
                                <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                    <span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
                            <span class="k">if</span> <span class="p">(</span>
                                    <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
                                        <span class="s1">&#39;target_label&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goto_target_lbl_after</span>
                                    <span class="ow">and</span> <span class="s2">&quot;goto-move&quot;</span> <span class="ow">in</span> <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span>
                            <span class="p">):</span>
                                <span class="k">del</span> <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;statement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span>
                            <span class="n">goto_stmt</span><span class="p">[</span><span class="s1">&#39;goto-stmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>
                        <span class="n">next_goto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goto_stmt</span><span class="p">)</span>
                    <span class="n">statement_num</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encapsulate_under_do_while</span><span class="p">:</span>
            <span class="n">goto_nest_if_elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;goto-move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
            <span class="n">reconstructed_if_elem</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goto_nest_if_elem</span><span class="p">)</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">goto_nest_if_elem</span><span class="p">)</span>

        <span class="c1"># Unconditional goto sets goto_flag always to false when it enters 2nd</span>
        <span class="c1"># if-statement</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">need_operation</span><span class="p">:</span>
            <span class="n">statement</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">body_elem</span><span class="p">,</span> <span class="s2">&quot;statement&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assignment_element</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
                                             <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span></div>

    <span class="c1">#################################################################</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#                       MISCELLANEOUS                           #</span>
    <span class="c1">#                                                               #</span>
    <span class="c1">#################################################################</span>

<div class="viewcode-block" id="RectifyOFPXML.clean_derived_type_ref"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.clean_derived_type_ref">[docs]</a>    <span class="k">def</span> <span class="nf">clean_derived_type_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function will clean up the derived type referencing syntax,</span>
<span class="sd">            which is stored in a form of &quot;id=&#39;x&#39;%y&quot; in the id attribute.</span>
<span class="sd">            Once the id gets cleaned, it will call the</span>
<span class="sd">            reconstruc_derived_type_ref function to reconstruct and replace the</span>
<span class="sd">            messy version</span>
<span class="sd">            of id with the cleaned version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_id</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span>
            <span class="s2">&quot;id&quot;</span>
        <span class="p">]</span>  <span class="c1"># 1. Get the original form of derived type id, which is in a form of,</span>
        <span class="c1"># for example, id=&quot;x&quot;%y in the original XML.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clean_id</span><span class="p">(</span><span class="n">current_id</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># 2. Extract the first variable name, for example, x in this case.</span>
        <span class="n">percent_sign</span> <span class="o">=</span> <span class="n">current_id</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
            <span class="s2">&quot;%&quot;</span>
        <span class="p">)</span>  <span class="c1"># 3. Get the location of the &#39;%&#39; sign.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_type_var_holder_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">current_id</span><span class="p">[</span><span class="n">percent_sign</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_id</span><span class="p">)]</span>
        <span class="p">)</span>  <span class="c1"># 4. Get the field variable. y in this example.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstruct_derived_type_ref</span><span class="p">(</span><span class="n">current</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.clean_id"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.clean_id">[docs]</a>    <span class="k">def</span> <span class="nf">clean_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unrefined_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function refines id (or value) with quotation marks included by</span>
<span class="sd">             removing them and returns only the variable name.</span>
<span class="sd">            For example, from &quot;OUTPUT&quot; to OUTPUT and &quot;x&quot; to x. Thus, the id</span>
<span class="sd">            name will be modified as below:</span>
<span class="sd">                Unrefined id: id = &quot;&quot;OUTPUT&quot;&quot;</span>
<span class="sd">                Refined id: id = &quot;OUTPUT&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">([^\&#39;]+)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">unrefined_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="RectifyOFPXML.clean_attrib"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.clean_attrib">[docs]</a>    <span class="k">def</span> <span class="nf">clean_attrib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The original XML elements holds &#39;eos&#39; and &#39;rule&#39; attributes that are</span>
<span class="sd">             not necessary and being used.</span>
<span class="sd">            Thus, this function will remove them in the rectified version of</span>
<span class="sd">            XML.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;eos&quot;</span> <span class="ow">in</span> <span class="n">elements</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;eos&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;rule&quot;</span> <span class="ow">in</span> <span class="n">elements</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;rule&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.boundary_identifier"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.boundary_identifier">[docs]</a>    <span class="k">def</span> <span class="nf">boundary_identifier</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goto_label_with_case</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function will be called to dientify the boundary for each goto-</span>
<span class="sd">            and-label. The definition of scope here is that whether one</span>
<span class="sd">            goto-label</span>
<span class="sd">            is nested under another goto-label. For example,</span>
<span class="sd">                &lt;label with lbl = 111&gt;</span>
<span class="sd">                    &lt;goto-stmt with lbl = 222&gt;</span>
<span class="sd">                    &lt;label with lbl = 222&gt;</span>
<span class="sd">                &lt;goto-stmt with lbl = 111&gt;</span>
<span class="sd">            In this case, &quot;goto-label with lbl = 222&quot; is within the scope of</span>
<span class="sd">            &quot;lbl = 111&quot;</span>
<span class="sd">            Thus, the elements will be assigned with &quot;parent-goto&quot; attribute</span>
<span class="sd">            with 111.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">boundary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lbl_counter</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">goto_label_in_order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">goto_and_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encountered_goto_label</span>
        <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">goto_and_labels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lbl_counter</span><span class="p">:</span>
                <span class="n">lbl_counter</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lbl_counter</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Identify each label&#39;s parent label (scope)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">goto_label_in_order</span><span class="p">:</span>
                <span class="n">goto_label_in_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goto_label_in_order</span><span class="p">:</span>
                    <span class="n">parent</span> <span class="o">=</span> <span class="n">goto_label_in_order</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">boundary</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span>
                    <span class="n">goto_label_in_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lbl</span><span class="p">)</span>

        <span class="c1"># Since the relationship betwen label:goto-stmt is 1:M,</span>
        <span class="c1"># find the label that has multiple goto-stmts.</span>
        <span class="c1"># Because that extra &lt;goto-stmt&gt; creates extra scope to</span>
        <span class="c1"># encapsulate other &#39;label-goto&#39; or &#39;goto-label&#39;.</span>
        <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">goto_label_in_order</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lbl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">boundary</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">counter</span> <span class="ow">in</span> <span class="n">lbl_counter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">boundary</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>

        <span class="c1"># This will check for the handled goto cases.</span>
        <span class="c1"># If any unhandled case encountered, then it will</span>
        <span class="c1"># assert and give out an error. Else, return nothing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case_availability</span> <span class="p">(</span><span class="n">boundary</span><span class="p">)</span>

        <span class="n">boundary_for_label</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_goto_assigner</span> <span class="p">(</span>
                <span class="n">boundary</span><span class="p">,</span> <span class="n">boundary_for_label</span><span class="p">,</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_before</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_goto_assigner</span> <span class="p">(</span>
                <span class="n">boundary</span><span class="p">,</span> <span class="n">boundary_for_label</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span><span class="s1">&#39;stmts-follow-goto&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_goto_assigner</span> <span class="p">(</span>
                <span class="n">boundary</span><span class="p">,</span> <span class="n">boundary_for_label</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statements_to_reconstruct_after</span><span class="p">[</span><span class="s1">&#39;stmts-follow-label&#39;</span><span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="RectifyOFPXML.case_availability"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.case_availability">[docs]</a>    <span class="k">def</span> <span class="nf">case_availability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function checks for the goto cases in the code based</span>
<span class="sd">            on the scope. If any unhandled case encountered, then it</span>
<span class="sd">            will assert and halt the program.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Case check for more than double nested goto case</span>
        <span class="n">nested_gotos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">root_scope</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">current_scope</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">goto</span><span class="p">,</span> <span class="n">scope</span> <span class="ow">in</span> <span class="n">boundary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">current_scope</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">current_scope</span> <span class="o">=</span> <span class="n">goto</span>
                <span class="n">root_scope</span> <span class="o">=</span> <span class="n">goto</span>
                <span class="n">nested_gotos</span><span class="p">[</span><span class="n">root_scope</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">scope</span> <span class="o">==</span> <span class="n">current_scope</span><span class="p">:</span>
                    <span class="n">nested_gotos</span><span class="p">[</span><span class="n">root_scope</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">nested_gotos</span><span class="p">[</span><span class="n">root_scope</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span>
                    <span class="p">),</span> <span class="n">f</span><span class="s2">&quot;Do do not handle &gt; 2 nested goto case at this moment.&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">root_scope</span> <span class="o">=</span> <span class="n">goto</span>
                    <span class="n">nested_gotos</span><span class="p">[</span><span class="n">root_scope</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">current_scope</span> <span class="o">=</span> <span class="n">goto</span>

        <span class="c1"># All cases are currently handled</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="RectifyOFPXML.parent_goto_assigner"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.RectifyOFPXML.parent_goto_assigner">[docs]</a>    <span class="k">def</span> <span class="nf">parent_goto_assigner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">boundary_for_label</span><span class="p">,</span>
                             <span class="n">statements_to_reconstruct</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            This function actually assigns scope(s) to each goto and label</span>
<span class="sd">            statements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="n">statements_to_reconstruct</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;goto-stmt&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">target_lbl</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lbl&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">target_lbl</span> <span class="ow">in</span> <span class="n">boundary</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">boundary</span><span class="p">[</span><span class="n">target_lbl</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">boundary</span><span class="p">[</span><span class="n">target_lbl</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>

            <span class="k">if</span> <span class="s2">&quot;target-label-statement&quot;</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">boundary_for_label</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">boundary_for_label</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">boundary_for_label</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stmt</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;parent-goto&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span></div></div>


<span class="c1">#################################################################</span>
<span class="c1">#                                                               #</span>
<span class="c1">#                     NON-CLASS FUNCTIONS                       #</span>
<span class="c1">#                                                               #</span>
<span class="c1">#################################################################</span>

<div class="viewcode-block" id="is_empty"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.is_empty">[docs]</a><span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is just a helper function for</span>
<span class="sd">        check whether the passed elements (i.e. list)</span>
<span class="sd">        is empty or not</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="indent"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.indent">[docs]</a><span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function indents each level of XML.</span>
<span class="sd">        Source: https://stackoverflow.com/questions/3095434/inserting-newlines</span>
<span class="sd">                -in-xml-file-generated-via-xml-etree-elementstree-in-python</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">level</span> <span class="o">*</span> <span class="s2">&quot;  &quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elem</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
            <span class="n">indent</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">elem</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="n">elem</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">i</span></div>


<div class="viewcode-block" id="buildNewASTfromXMLString"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.buildNewASTfromXMLString">[docs]</a><span class="k">def</span> <span class="nf">buildNewASTfromXMLString</span><span class="p">(</span><span class="n">xmlString</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function process OFP generated XML and generates</span>
<span class="sd">        a rectified version by recursively calling the appropriate</span>
<span class="sd">        functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">traverse</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">ofpAST</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="n">xmlString</span><span class="p">)</span>
    <span class="n">XMLCreator</span> <span class="o">=</span> <span class="n">RectifyOFPXML</span><span class="p">()</span>
    <span class="c1"># A root of the new AST</span>
    <span class="n">newRoot</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">ofpAST</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">ofpAST</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
    <span class="c1"># First add the root to the new AST list</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ofpAST</span><span class="p">:</span>
        <span class="c1"># Handle only non-empty elementss</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">newRoot</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="n">XMLCreator</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">newRoot</span><span class="p">,</span> <span class="n">newRoot</span><span class="p">,</span> <span class="n">traverse</span><span class="p">)</span>

    <span class="c1"># Indent and structure the tree properly</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">newRoot</span><span class="p">)</span>
    <span class="n">indent</span><span class="p">(</span><span class="n">newRoot</span><span class="p">)</span>

    <span class="c1"># Checks if the rectified AST requires goto elimination,</span>
    <span class="c1"># if it does, it does a 2nd traverse to eliminate and</span>
    <span class="c1"># reconstruct the AST once more</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">XMLCreator</span><span class="o">.</span><span class="n">need_goto_elimination</span><span class="p">):</span>
        <span class="n">oldRoot</span> <span class="o">=</span> <span class="n">newRoot</span>
        <span class="n">traverse</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">XMLCreator</span><span class="o">.</span><span class="n">boundary_identifier</span><span class="p">(</span><span class="n">XMLCreator</span><span class="o">.</span><span class="n">goto_label_with_case</span><span class="p">)</span>

        <span class="n">newRoot</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="n">oldRoot</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">oldRoot</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">oldRoot</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">cur_elem</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">newRoot</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
                <span class="n">XMLCreator</span><span class="o">.</span><span class="n">parseXMLTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">cur_elem</span><span class="p">,</span> <span class="n">newRoot</span><span class="p">,</span> <span class="n">newRoot</span><span class="p">,</span>
                                        <span class="n">traverse</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">newRoot</span><span class="p">)</span>
        <span class="n">indent</span><span class="p">(</span><span class="n">newRoot</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">XMLCreator</span><span class="o">.</span><span class="n">continue_elimination</span><span class="p">:</span>
            <span class="n">XMLCreator</span><span class="o">.</span><span class="n">need_goto_elimination</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">newRoot</span></div>


<div class="viewcode-block" id="parse_args"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.parse_args">[docs]</a><span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function parse the arguments passed to the script.</span>
<span class="sd">        It returns a tuple of (input ofp xml, output xml)</span>
<span class="sd">        file names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--file&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;OFP generated XML file needs to be passed.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;-g&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--gen&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A rectified version of XML.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">if</span> <span class="p">(</span>
            <span class="n">args</span><span class="o">.</span><span class="n">file</span> <span class="o">!=</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">gen</span> <span class="o">!=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">ofpFile</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rectifiedFile</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">gen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="kc">False</span>
        <span class="p">),</span> <span class="n">f</span><span class="s2">&quot;[[ Missing either input or output file.</span><span class="se">\</span>
<span class="s2">             Input: </span><span class="si">{args.file}</span><span class="s2">, Output: </span><span class="si">{args.gen}</span><span class="s2"> ]]&quot;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">ofpFile</span><span class="p">,</span> <span class="n">rectifiedFile</span><span class="p">)</span></div>


<div class="viewcode-block" id="fileChecker"><a class="viewcode-back" href="../../../../delphi.translators.for2py.html#delphi.translators.for2py.rectify.fileChecker">[docs]</a><span class="k">def</span> <span class="nf">fileChecker</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function checks for the validity (file existance and</span>
<span class="sd">        mode). If either the file does not exist or the mode is</span>
<span class="sd">        not valid, throws an IO exception and terminates the program</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="kc">False</span>
        <span class="p">),</span> <span class="n">f</span><span class="s2">&quot;File </span><span class="si">{filename}</span><span class="s2"> does not exit or invalid mode </span><span class="si">{mode}</span><span class="s2">.&quot;</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="p">(</span><span class="n">ofpFile</span><span class="p">,</span> <span class="n">rectifiedFile</span><span class="p">)</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># Since we pass the file name to the element</span>
    <span class="c1"># tree parser not opening it with open function,</span>
    <span class="c1"># we check for the validity before the file name</span>
    <span class="c1"># is actually passed to the parser</span>
    <span class="n">fileChecker</span><span class="p">(</span><span class="n">ofpFile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">ofpXML</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">ofpFile</span><span class="p">)</span>
    <span class="n">ofpXMLRoot</span> <span class="o">=</span> <span class="n">ofpXML</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>

    <span class="c1"># Converts the XML tree into string</span>
    <span class="n">ofpXMLStr</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">ofpXMLRoot</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="c1"># Call buildNewASTfromXMLString to rectify the XML</span>
    <span class="n">rectifiedXML</span> <span class="o">=</span> <span class="n">buildNewASTfromXMLString</span><span class="p">(</span><span class="n">ofpXMLStr</span><span class="p">)</span>
    <span class="n">rectifiedTree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">rectifiedXML</span><span class="p">)</span>

    <span class="c1"># The write function is used with the generated</span>
    <span class="c1"># XML tree object not with the file object. Thus,</span>
    <span class="c1"># same as the ofpFile, we do a check for the validity</span>
    <span class="c1"># of a file before pass to the ET tree object&#39;s write</span>
    <span class="c1"># function</span>
    <span class="n">fileChecker</span><span class="p">(</span><span class="n">rectifiedFile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">rectifiedTree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rectifiedFile</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Adarsh

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>